<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spin the Wheel ‚Äî VIP</title>
  <style>
:root {
  --bg: #110E07;
  --panel-bg: #1D1D1D;
  --accent: #DBC458;
  --yellow: #FFE066;      /* lighter yellow for general text */
  --rank-yellow: #8B681F; /* for ranks (VIP etc) */
  --green: #0f990c;       /* Luck Potion II text */
  --purple: #9b59b6;
  --white: #EEEEEE;
  --dark: #8B681F;
  --chat-bg: #1D1D1D;
}

body {
  margin: 0; padding: 0;
  background: var(--bg);
  color: var(--yellow); /* lighter yellow for most text */
  font-family: Arial, sans-serif;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  height: 100vh;
  overflow: hidden;
}

#main-container {
  display: flex;
  gap: 20px;
  padding: 20px;
  width: 100%;
  box-sizing: border-box;
}

#left-panel, #right-panel, #controls, #shop, #give-coins, #chat-box {
  background: var(--panel-bg);
  border-radius: 12px;
  padding: 15px;
  box-sizing: border-box;
  box-shadow: 0 2px 12px 0 rgba(0,0,0,0.15);
  color: var(--yellow); /* lighter yellow for panel text */
}

#center-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  color: var(--yellow); /* lighter yellow for center panel */
}

h2 {
  margin-top: 0;
  color: var(--yellow);
}

#leaderboardList {
  flex: 0 1 auto;
  overflow-y: auto;
  padding: 0;
  list-style: none;
  margin: 0;
}

#leaderboardList li {
  margin: 6px 0;
  color: var(--yellow); /* lighter yellow for list */
}

#chat-box {
  flex: 1;
  display: flex;
  flex-direction: column;
  margin-top: 20px;
  color: var(--yellow); /* lighter yellow for chat */
}

#chat-messages {
  background: var(--chat-bg);
  flex: 1;
  border-radius: 6px;
  padding: 10px;
  overflow-y: auto;
  height: 140px;
  color: var(--yellow); /* lighter yellow for chat messages */
}

#chat-input-area {
  display: flex;
  gap: 6px;
  margin-top: 8px;
}

/* Text boxes - keep text white */
#chatMessage,
#give-coins input,
#controls input {
  color: var(--white);
  background: var(--dark);
  border: none;
  border-radius: 4px;
  padding: 6px;
}

/* Buttons */
#sendChat,
#giveBtn,
#controls button,
.shop-item button {
  background: var(--accent);
  color: #1D1D1D;
  border-radius: 4px;
  font-weight: bold;
  cursor: pointer;
  border: none;
  padding: 6px 12px;
}

#wheel-pointer {
  font-size: 36px;
  color: var(--accent);
  position: relative;
  top: -450px;
  text-align: center;
  transform: rotate(180deg);
  pointer-events: none;
  text-shadow: 0 0 10px var(--accent);
}

canvas {
  border: 6px solid var(--accent);
  border-radius: 50%;
  background: var(--dark);
}

/* Shop area and ranks */
#shop {
  margin-top: 30px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  color: var(--yellow); /* lighter yellow for shop text */
}

/* Shop labels and ranks: use custom colors */
.shop-item .vip-label {
  font-weight: bold;
  color: var(--rank-yellow); /* darker yellow for ranks (VIP etc) */
}
.shop-item .vip-label.vip { color: var(--rank-yellow); }
.shop-item .vip-label.vip-plus { color: #f1c40f; }
.shop-item .vip-label.vip-plusplus { color: #9b59b6; }
.shop-item .vip-label.luck,
.shop-item .vip-label.luck-II { color: #0f990c !important; }
.shop-item .vip-label.stealer { color: orange; }

/* Shop h2 stays lighter yellow */
#shop h2 {
  margin-bottom: 12px;
  color: var(--yellow);
}

#luck-timer {
  font-size: 13px;
  font-weight: normal;
  color: #0f990c;
  margin-left: 8px;
}
  </style>
</head>
<body>
<div id="main-container">
  <div id="left-panel">
    <h2>üèÜ Leaderboard</h2>
    <ul id="leaderboardList"></ul>
    <div id="chat-box">
      <h2>üí¨ Chat</h2>
      <div id="chat-messages"></div>
      <div id="chat-input-area">
        <input id="chatMessage" type="text" placeholder="Type a message..." maxlength="100">
        <button id="sendChat">Send</button>
      </div>
    </div>
  </div>
  <div id="center-panel">
    <canvas id="wheel" width="400" height="400"></canvas>
    <div id="controls">
      <div id="wheel-pointer">‚ñ≤</div>
      <input id="username" type="text" placeholder="Username (max 10)" maxlength="10">
      <input id="userPassword" type="password" placeholder="Password">
      <button id="setUsername">Set Username</button>
      <p id="userinfo">Not logged in</p>
      <input id="bet" type="number" placeholder="Bet amount">
      <button id="spin">SPIN üé°</button>
    </div>
  </div>
  <div id="right-panel">
    <h2>üéÅ Give Coins</h2>
    <div id="give-coins">
      <input id="giveToUser" type="text" placeholder="Username">
      <input id="giveAmount" type="number" placeholder="Amount">
      <button id="giveBtn">Give</button>
    </div>
    <div id="shop">
      <h2>üõí Shop</h2>
      <div class="shop-item">
        <span class="vip-label vip">‚≠êVIP</span>
        <button id="buyVIP">Buy for 1000</button>
      </div>
      <div class="shop-item">
        <span class="vip-label vip-plus">‚öúÔ∏èVIP+</span>
        <button id="buyVIPplus">Buy for 5000</button>
      </div>
      <div class="shop-item">
        <span class="vip-label vip-plusplus">üíéVIP++</span>
        <button id="buyVIPplusplus">Buy for 10000</button>
      </div>
      <div class="shop-item">
        <span class="vip-label luck">‚òòÔ∏éLuck Potion +5%</span>
        <button id="buyLuckPotion">Buy for 500</button>
        <span id="luck-timer-5"></span>
      </div>
      <div class="shop-item">
        <span class="vip-label luck">üçÄLuck Potion II +20%</span>
        <button id="buyLuckPotion2">Buy for 1500</button>
        <span id="luck-timer-20"></span>
      </div>
      <div class="shop-item">
        <span class="vip-label stealer">üí∞the stealer</span>
        <input id="stealTarget" type="text" placeholder="Target username" style="width:90px;">
        <button id="buyStealer">Use for 2000</button>
      </div>
    </div>
  </div>
</div>
<script>
const apiURL = 'https://68e839b2f2707e6128ca35e1.mockapi.io/players';
let playerData = null;
let allPlayers = [];

const slices = [
  "1.5x", "0.5x", "0.5x", "1.1x", "1.8x", "10x", "1.9x", "lose",
  "lose", "1.7x", "lose", "1x", "lose", "1x", "lose", "lose",
  "1.4x", "2.5x", "lose", "1.2x", "lose", "lose", "2.0x", "lose",
  "5.0x", "1.3x", "lose", "1.6x", "0.5x", "lose", "2.5x", "lose",
  "0.75x", "lose", "lose", "2.0x", "lose", "lose"
];

const wheel = document.getElementById("wheel");
const spinBtn = document.getElementById("spinBtn");
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("password");
const loginForm = document.getElementById("loginForm");
const messageBox = document.getElementById("message");
const coinDisplay = document.getElementById("coins");

// Create wheel slices
function drawWheel() {
  const numSlices = slices.length;
  const angle = 360 / numSlices;
  wheel.innerHTML = "";
  for (let i = 0; i < numSlices; i++) {
    const slice = document.createElement("div");
    slice.className = "slice";
    slice.style.transform = `rotate(${i * angle}deg) skewY(${90 - angle}deg)`;
    slice.innerHTML = `<span style="transform: skewY(-${90 - angle}deg) rotate(${angle / 2}deg)">${slices[i]}</span>`;
    wheel.appendChild(slice);
  }
}

drawWheel();

// Fetch players
async function fetchPlayers() {
  const res = await fetch(apiURL);
  return await res.json();
}

// Login system
loginForm.onsubmit = async (e) => {
  e.preventDefault();
  const username = usernameInput.value.trim();
  const password = passwordInput.value;

  const players = await fetchPlayers();
  let player = players.find(p => p.name === username);

  if (player) {
    if (player.password === password) {
      playerData = player;
      messageBox.textContent = `Welcome back ${username}!`;
      showGameUI();
    } else {
      messageBox.textContent = "Wrong password!";
    }
  } else {
    const newPlayer = { name: username, password, coins: 100, notCoins: 0 };
    const res = await fetch(apiURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(newPlayer)
    });
    playerData = await res.json();
    messageBox.textContent = `Welcome ${username}, you got 100 coins!`;
    showGameUI();
  }
};

function showGameUI() {
  document.getElementById("loginBox").style.display = "none";
  document.getElementById("gameBox").style.display = "block";
  updateCoins();
}

// Sync coins from database every few seconds
async function syncCoins() {
  if (!playerData) return;
  const res = await fetch(`${apiURL}/${playerData.id}`);
  const freshData = await res.json();
  playerData.coins = freshData.coins;
  updateCoins();
}
setInterval(syncCoins, 3000);

function updateCoins() {
  coinDisplay.textContent = `üí∞ ${Math.round(playerData.coins)} coins`;
}

// Spin wheel logic
spinBtn.onclick = async () => {
  if (!playerData) return;
  if (playerData.coins < 10) {
    messageBox.textContent = "Not enough coins to spin!";
    return;
  }

  // Deduct spin cost
  playerData.coins -= 10;
  updateCoins();
  await updatePlayer();

  const deg = Math.floor(5000 + Math.random() * 5000);
  wheel.style.transition = "transform 5s ease-out";
  wheel.style.transform = `rotate(${deg}deg)`;
  spinBtn.disabled = true;

  setTimeout(async () => {
    wheel.style.transition = "none";
    const actualDeg = deg % 360;
    const sliceSize = 360 / slices.length;
    const index = Math.floor((360 - actualDeg) / sliceSize) % slices.length;
    const result = slices[index];

    if (result.includes("x")) {
      const multiplier = parseFloat(result.replace("x", ""));
      const winAmount = Math.round(10 * multiplier);
      playerData.coins += winAmount;
      messageBox.textContent = `üéâ You won ${winAmount} coins (${multiplier}x)!`;
    } else {
      messageBox.textContent = "üò¢ You lost!";
    }

    updateCoins();
    await updatePlayer();
    spinBtn.disabled = false;
  }, 5200);
};

// Update player in API
async function updatePlayer() {
  await fetch(`${apiURL}/${playerData.id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(playerData)
  });
}
</script>
</body>
</html>
